"use strict";(self.webpackChunkmy_blog=self.webpackChunkmy_blog||[]).push([[8742],{1977:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>c,frontMatter:()=>s,metadata:()=>t,toc:()=>u});const t=JSON.parse('{"id":"cloud/azure/azure-sql","title":"Azure SQL","description":"Azure SQL","source":"@site/docs/cloud/azure/azure-sql.mdx","sourceDirName":"cloud/azure","slug":"/cloud/azure/azure-sql","permalink":"/docs/cloud/azure/azure-sql","draft":false,"unlisted":false,"tags":[{"inline":true,"label":"sql","permalink":"/docs/tags/sql"},{"inline":true,"label":"database","permalink":"/docs/tags/database"},{"inline":true,"label":"serverless","permalink":"/docs/tags/serverless"},{"inline":true,"label":"Azure","permalink":"/docs/tags/azure"}],"version":"current","lastUpdatedBy":"ShigureDD","lastUpdatedAt":1756656000000,"sidebarPosition":3,"frontMatter":{"sidebar_position":3,"description":"Azure SQL","tags":["sql","database","serverless","Azure"],"keywords":["sql","database","serverless","Azure"],"last_update":{"date":"2025/09/01 GMT+8","author":"ShigureDD"}},"sidebar":"docs","previous":{"title":"Web App","permalink":"/docs/cloud/azure/app-service"},"next":{"title":"Function App - Cron Job","permalink":"/docs/cloud/azure/function-app-cron-job"}}');var r=a(74848),i=a(28453);const s={sidebar_position:3,description:"Azure SQL",tags:["sql","database","serverless","Azure"],keywords:["sql","database","serverless","Azure"],last_update:{date:"2025/09/01 GMT+8",author:"ShigureDD"}},o="Azure SQL",d={},u=[{value:"Different between Azure SQL Server and Microsoft SQL Server",id:"different-between-azure-sql-server-and-microsoft-sql-server",level:2},{value:"Data Migration",id:"data-migration",level:3},{value:"Set up Elastic Job Agent",id:"set-up-elastic-job-agent",level:3},{value:"Json dataType",id:"json-datatype",level:2}];function l(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",mermaid:"mermaid",p:"p",pre:"pre",strong:"strong",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"azure-sql",children:"Azure SQL"})}),"\n",(0,r.jsx)(n.p,{children:"Azure SQL Database is a serverless database service."}),"\n",(0,r.jsx)(n.p,{children:"Architecture"}),"\n",(0,r.jsx)(n.mermaid,{value:"architecture-beta\n    group azure(logos:microsoft-azure)[Azure]\n    group SQL_Server(server)[sqlserver] in azure\n    group pool(cloud)[Elastic Pool] in SQL_Server\n    group SQL_Server2(server)[agent] in azure\n\n    service db(database)[Database] in SQL_Server\n    service db_1(database)[Databases] in pool\n    service db_2(database)[Database] in SQL_Server2\n\n    db_1:R <-- L:db_2\n\n"}),"\n",(0,r.jsx)(n.h2,{id:"different-between-azure-sql-server-and-microsoft-sql-server",children:"Different between Azure SQL Server and Microsoft SQL Server"}),"\n",(0,r.jsx)(n.p,{children:"Azure SQL Server do not have SQL Server Agent.\nTo have a same function in Azure SQL server need to create a Elastic Job Agent on Azure.\nGrant access for the Agent to the azure sql server as a worker."}),"\n",(0,r.jsx)(n.p,{children:"** If you want all sql server function, SQL managed instances is best for most migrations to the cloud."}),"\n",(0,r.jsx)(n.h3,{id:"data-migration",children:"Data Migration"}),"\n",(0,r.jsxs)(n.p,{children:["To migrate the Data from on-premises SQL Server to Azure, you can use ",(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.a,{href:"https://www.microsoft.com/en-us/download/details.aspx?id=53595",children:"Microsoft Data Migration Assistant"})}),"."]}),"\n",(0,r.jsx)(n.h3,{id:"set-up-elastic-job-agent",children:"Set up Elastic Job Agent"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-SQL",children:"/****** init agent db  ******/\nCREATE MASTER KEY ENCRYPTION BY PASSWORD='P@ssw0rd';\n\nCREATE DATABASE SCOPED CREDENTIAL JobExecution\nWITH IDENTITY = 'JobUser',\nSECRET = 'P@ssw0rd';\nGO\n\nCREATE DATABASE SCOPED CREDENTIAL MasterUser\nWITH IDENTITY = 'MasterUser',\nSECRET ='P@ssw0rd';\n\n/****** all azure server  ******/\nCREATE LOGIN MasterUser\n\tWITH PASSWORD = 'P@ssw0rd';\nGO\n\n/****** create target group in agent db  ******/\nEXEC jobs.sp_add_target_group 'ShardDatabase'\n\nEXEC jobs.sp_add_target_group_member\nN'ShardDatabase',\n@target_type = N'SqlServer',\n@refresh_credential_name = 'MasterUser',\n@server_name ='dbserver.database.windows.net'\n\nEXEC jobs.sp_add_target_group 'target_group'\n\n\nEXEC jobs.sp_add_target_group_member N'target_group',\n@target_type = N'SqlDatabase',\n@server_name ='dbserver.database.windows.net',\n@database_name ='db1'\n\n--verify\nSELECT * FROM jobs.target_groups\nSELECT *\nFROM jobs.target_group_members\n\n/****** create job user in all master_DB ******/\nCREATE LOGIN jobuser\n\tWITH PASSWORD = 'P@ssw0rd';\nGO\n\nCREATE USER jobuser\n\tFOR LOGIN jobuser\n\tWITH DEFAULT_SCHEMA = dbo\nGO\n\n/****** create login in target_DB ******/\nCREATE USER jobuser\n\tFOR LOGIN jobuser\n\tWITH DEFAULT_SCHEMA = dbo\nGO\n\nEXEC sp_addrolemember N'db_owner', N'jobuser'\n\n\n/****** create login in agent_DB ******/\nCREATE USER jobuser\n\tFOR LOGIN jobuser\n\tWITH DEFAULT_SCHEMA = dbo\nGO\n\nEXEC sp_addrolemember N'db_owner', N'jobuser'\n\n/****** create login in agent_DB ******/\nEXEC jobs.sp_add_job @job_name ='job_name_1', @description ='description 1'\n\nEXEC jobs.sp_add_jobstep @job_name = 'jobstep 1', @command = 'Select 1';', @step_name ='[Pre Processing]', @credential_name = 'JobExecution', @target_group_name= 'target_group'\n\nEXEC jobs.sp_add_jobstep @job_name = 'jobstep 2', @command = 'Select 1', @step_name ='[step_name_2]', @credential_name = 'JobExecution', @target_group_name= 'target_group'\n\nEXEC jobs.sp_add_jobstep @job_name = 'jobstep 3', @command = 'Select 1', @step_name ='[last_step]', @credential_name = 'JobExecution', @target_group_name= 'target_group'\n\n\n--verify\nSELECT *\n    FROM jobs.jobs\n\nSELECT * FROM jobs.job_versions\n\nSELECT *\nFROM jobs.jobsteps\n\n--UTC time and update job start time\nExec jobs.sp_update_job @job_name='job_name_1', @enabled = 1, @schedule_interval_type ='Days', @schedule_start_time = N'2023-01-10 00:00:00'\n\n"})}),"\n",(0,r.jsx)(n.h2,{id:"json-datatype",children:"Json dataType"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'INSERT INTO jjsson ( [info]) VALUES( \'[\n  {\n    "_id": "68806054b7a266dde87445a2",\n    "index": 0,\n    "guid": "58b49b33-68e3-446d-9ff6-c3259d9547cf",\n    "isActive": false,\n    "balance": "$2,947.30",\n    "picture": "http://placehold.it/32x32",\n    "age": 20,\n    "eyeColor": "blue",\n    "name": "Middleton Rios",\n    "gender": "male",\n    "company": "FURNITECH",\n    "email": "middletonrios@furnitech.com",\n    "phone": "+1 (934) 590-2233",\n    "address": "925 Windsor Place, Fairmount, Nebraska, 6215",\n    "about": "Reprehenderit nulla sit elit in eu magna magna id laborum deserunt anim aute. Laboris voluptate dolore dolor minim id Lorem anim reprehenderit ut quis labore deserunt incididunt exercitation. Adipisicing dolor culpa consequat do dolor fugiat et laborum voluptate id nisi in aliqua aliqua. Dolor esse nisi est pariatur. Sunt deserunt eu incididunt consectetur tempor tempor proident aliquip veniam dolore labore pariatur cupidatat.\\r\\n",\n    "registered": "2021-02-19T02:29:36 -08:00",\n    "latitude": -2.670389,\n    "longitude": 77.98231,\n    "tags": [\n      "magna",\n      "excepteur",\n      "qui",\n      "cupidatat",\n      "amet",\n      "ut",\n      "anim"\n    ],\n    "friends": [\n      {\n        "id": 0,\n        "name": "Vera Patterson"\n      },\n      {\n        "id": 1,\n        "name": "Erin Sanders"\n      },\n      {\n        "id": 2,\n        "name": "Kim Mitchell"\n      }\n    ],\n    "greeting": "Hello, Middleton Rios! You have 4 unread messages.",\n    "favoriteFruit": "apple"\n  },\n  {\n    "_id": "688060542953d0374862ea3b",\n    "index": 1,\n    "guid": "8864d47a-2a04-407f-ab44-fb7438808963",\n    "isActive": true,\n    "balance": "$3,896.94",\n    "picture": "http://placehold.it/32x32",\n    "age": 35,\n    "eyeColor": "green",\n    "name": "Terra Powers",\n    "gender": "female",\n    "company": "DANCITY",\n    "email": "terrapowers@dancity.com",\n    "phone": "+1 (920) 451-3141",\n    "address": "835 Madison Street, Saranap, South Dakota, 9711",\n    "about": "Ex sunt aliqua officia mollit est eu Lorem. Amet enim velit ea elit. In duis Lorem veniam exercitation ad exercitation officia laboris incididunt. Deserunt aliqua tempor esse ipsum deserunt cupidatat. Cillum non esse reprehenderit consequat exercitation cillum duis voluptate cupidatat eiusmod. Culpa laborum et incididunt qui do sunt pariatur aliqua minim ea fugiat.\\r\\n",\n    "registered": "2019-03-27T03:58:33 -08:00",\n    "latitude": -44.648637,\n    "longitude": 168.644222,\n    "tags": [\n      "velit",\n      "pariatur",\n      "aute",\n      "tempor",\n      "Lorem",\n      "est",\n      "enim"\n    ],\n    "friends": [\n      {\n        "id": 0,\n        "name": "Witt Flynn"\n      },\n      {\n        "id": 1,\n        "name": "Marisol Morse"\n      },\n      {\n        "id": 2,\n        "name": "Bender Gould"\n      }\n    ],\n    "greeting": "Hello, Terra Powers! You have 7 unread messages.",\n    "favoriteFruit": "strawberry"\n  },\n  {\n    "_id": "68806054bc2a389fafd43978",\n    "index": 2,\n    "guid": "af3808e7-3e0f-4349-90e7-afe3ddc5901f",\n    "isActive": true,\n    "balance": "$3,912.32",\n    "picture": "http://placehold.it/32x32",\n    "age": 32,\n    "eyeColor": "brown",\n    "name": "Walter Rush",\n    "gender": "male",\n    "company": "MIRACULA",\n    "email": "walterrush@miracula.com",\n    "phone": "+1 (950) 557-3120",\n    "address": "448 Harbor Court, Malott, Federated States Of Micronesia, 1517",\n    "about": "Anim ipsum consectetur consectetur voluptate commodo elit minim ea ex enim. Do exercitation nostrud mollit do fugiat pariatur magna. Anim voluptate minim ullamco incididunt ut cillum aute ut.\\r\\n",\n    "registered": "2021-11-21T07:14:33 -08:00",\n    "latitude": -76.5067,\n    "longitude": -12.779176,\n    "tags": [\n      "enim",\n      "dolor",\n      "quis",\n      "voluptate",\n      "aliquip",\n      "cillum",\n      "laboris"\n    ],\n    "friends": [\n      {\n        "id": 0,\n        "name": "Keith Conway"\n      },\n      {\n        "id": 1,\n        "name": "Nellie Clay"\n      },\n      {\n        "id": 2,\n        "name": "Lori Knowles"\n      }\n    ],\n    "greeting": "Hello, Walter Rush! You have 9 unread messages.",\n    "favoriteFruit": "strawberry"\n  },\n  {\n    "_id": "6880605466779b33092bfd5a",\n    "index": 3,\n    "guid": "3465a938-76ba-4629-9b35-87ed4087edfb",\n    "isActive": true,\n    "balance": "$1,041.84",\n    "picture": "http://placehold.it/32x32",\n    "age": 37,\n    "eyeColor": "green",\n    "name": "Barlow Schultz",\n    "gender": "male",\n    "company": "SLUMBERIA",\n    "email": "barlowschultz@slumberia.com",\n    "phone": "+1 (819) 409-2902",\n    "address": "238 Vanderbilt Avenue, Florence, New Hampshire, 5533",\n    "about": "Laborum ipsum commodo veniam sint ad ut ut culpa. In exercitation aliquip dolore proident sunt in ex do amet eiusmod elit sit. Do qui et eu tempor aliquip qui excepteur do ullamco quis voluptate. Labore labore consectetur minim quis aute ea anim ea anim excepteur nulla. Cupidatat aute sit fugiat Lorem non veniam magna consequat exercitation excepteur amet Lorem eu. Esse consectetur fugiat sit non.\\r\\n",\n    "registered": "2020-05-15T11:40:29 -08:00",\n    "latitude": -53.022564,\n    "longitude": -123.579747,\n    "tags": [\n      "id",\n      "commodo",\n      "officia",\n      "nisi",\n      "culpa",\n      "do",\n      "irure"\n    ],\n    "friends": [\n      {\n        "id": 0,\n        "name": "Hanson English"\n      },\n      {\n        "id": 1,\n        "name": "Leanna Howe"\n      },\n      {\n        "id": 2,\n        "name": "Maxwell Pierce"\n      }\n    ],\n    "greeting": "Hello, Barlow Schultz! You have 4 unread messages.",\n    "favoriteFruit": "apple"\n  },\n  {\n    "_id": "68806054a418207423594f72",\n    "index": 4,\n    "guid": "d63dff28-78b2-4a91-b3b8-116178a5a044",\n    "isActive": true,\n    "balance": "$3,377.47",\n    "picture": "http://placehold.it/32x32",\n    "age": 38,\n    "eyeColor": "brown",\n    "name": "Lara Burgess",\n    "gender": "female",\n    "company": "SONGLINES",\n    "email": "laraburgess@songlines.com",\n    "phone": "+1 (987) 432-2451",\n    "address": "499 Vista Place, Wikieup, Delaware, 8335",\n    "about": "Reprehenderit esse deserunt excepteur excepteur magna culpa minim amet occaecat deserunt anim. Consectetur id deserunt adipisicing voluptate laboris consectetur sunt minim commodo eiusmod fugiat velit. Pariatur occaecat esse dolor incididunt magna amet deserunt enim non do adipisicing. Quis deserunt irure et labore ut anim enim ut. Ullamco proident deserunt id duis excepteur aute aliqua et proident anim culpa magna.\\r\\n",\n    "registered": "2023-12-22T09:25:47 -08:00",\n    "latitude": 4.192028,\n    "longitude": -52.130913,\n    "tags": [\n      "minim",\n      "ipsum",\n      "laborum",\n      "esse",\n      "magna",\n      "voluptate",\n      "dolore"\n    ],\n    "friends": [\n      {\n        "id": 0,\n        "name": "Hampton Cole"\n      },\n      {\n        "id": 1,\n        "name": "West Swanson"\n      },\n      {\n        "id": 2,\n        "name": "Warren Tran"\n      }\n    ],\n    "greeting": "Hello, Lara Burgess! You have 10 unread messages.",\n    "favoriteFruit": "strawberry"\n  }\n]\');\nUPDATE [jjsson]\nSET info.modify(\'$[0].age\', 14859)\nWHERE id = 2;\nUPDATE jjsson\nSET info.modify(\'$.b\', \'def\')\nWHERE id = 1;\n\nSelect * from jjsson\n\nDECLARE @info NVARCHAR(100) = \'[{"name":"John","skills":["C#","SQL"]}]\';\nPRINT @info;\n\n-- Update name\nSET @info = JSON_MODIFY(@info, \'$[0].name\', \'Mike\');\nPRINT @info;\n\n-- Insert surname\nSET @info = JSON_MODIFY(@info, \'$.surname\', \'Smith\');\nPRINT @info;\n\n-- Set name NULL\nSET @info = JSON_MODIFY(@info, \'strict $.name\', NULL);\nPRINT @info;\n\n-- Delete name\nSET @info = JSON_MODIFY(@info, \'$.name\', NULL);\nPRINT @info;\n\n-- Add skill\nSET @info = JSON_MODIFY(@info, \'append $.skills\', \'Azure\');\nPRINT @info;\n'})})]})}function c(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},28453:(e,n,a)=>{a.d(n,{R:()=>s,x:()=>o});var t=a(96540);const r={},i=t.createContext(r);function s(e){const n=t.useContext(i);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);